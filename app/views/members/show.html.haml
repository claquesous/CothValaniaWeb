%p#notice= notice

%p
  %b Name:
  = @member.name
%p
  %b Join date:
  = @member.join_date
%p
  %b Points:
  = @member.points
%p
  %b Url:
  = @member.url
%p
  %b Remarks:
  = @member.remarks
%p
  %b Active:
  = @member.active
%p
  %b Admin:
  = @member.admin
%p
  %b Leader:
  = @member.leader
%p
  %b Reward cycle:
  = @member.reward_cycle
%p
  %b Cycle date:
  = @member.cycle_date

%table
  %tr
    %th Name
    %th Points
    %th Remarks
    %th Sex
    %th Race
    - @jobs.each do |j|
      %th= j.name
  - @member.characters.each do |c|
    %tr
      %td= c.name
      %td= c.current_points
      %td= c.remarks
      %td= c.sex
      %td= c.race.name unless c.race.nil?
      - @jobs.each do |j|
        %td= c.jobs.include?(j)

%p
  %b Event Attendance 
  %table
    - @member.event_attendances.order_by_date.each do |e|
      %tr
        %td= link_to e.occurrence.end_time.to_date, event_occurrence_path(e.occurrence.event_id, e.occurrence)
        %td= link_to e.event.name, event_path(e.event)
        %td (#{e.character.name} #{e.event.points})

%p
  %b Drops List
  %table
    - @member.character_rewards.order(:preference).each do |r|
      %tr
        %td #{r.preference}.
        %td= link_to r.reward.name, reward_path(r.reward)
        - if r.obtained
          %td Obtained (#{r.obtained_points})
        - else
          %td Points: #{@member.points.to_f/r.preference}

%p
  %b Drops Obtained
  %table
    - @member.character_rewards.order(:preference).each do |r|
      - if r.obtained
        %tr
          %td= link_to r.reward.name, reward_path(r.reward)
          %td= link_to r.occurrence.end_time.to_date, event_occurrence_path(r.occurrence.event_id, r.occurrence) unless r.occurrence.nil?
          %td= r.obtained_points

= link_to 'Edit', edit_member_path(@member)
\|
= link_to 'Back', members_path
